var v=class{constructor(t){this.positions=[];this.distinct=t.distinct}add(t){if(this.distinct&&this.has(t))return;let e=this.convertPositionToStr(t);this.positions.push(e)}has(t){let e=this.convertPositionToStr(t);return this.positions.indexOf(e)!=-1}size(){return this.positions.length}convertPositionToStr(t){return t.x+","+t.y}},P=v;var M=class{constructor(){this.cache={}}hasNextMove(t){let e=this.getPlayer(t);return!!this.findNextMove(t,e)}nextMove(t){let e=this.getPlayer(t),i=this.findNextMove(t,e);i&&(this.setCacheValue(t,"nextMove",null),this.movePlayer(t,e,i))}findNextMove(t,e){let i=this.getCacheValue(t,"nextMove");return i||(i=this.predictNextMove(t,e),this.setCacheValue(t,"nextMove",i)),i}predictNextMove(t,e){let i=this.getNextPlayerPosition(t,e);return t.isValidPosition(i.position)?i:null}getNextPlayerPosition(t,e){let i=e.direction,o=e.position;for(let s=0;s<4;s++){let r=this.getNextPositionByDirection(o,i);if(!t.isPositionOccupied(r))return{position:r,direction:i};i=this.nextDirection(i)}throw new Error("Player is stuck")}getNextPositionByDirection(t,e){switch(e){case"up":return{x:t.x,y:t.y-1};case"right":return{x:t.x+1,y:t.y};case"down":return{x:t.x,y:t.y+1};case"left":return{x:t.x-1,y:t.y}}}nextDirection(t){switch(t){case"up":return"right";case"right":return"down";case"down":return"left";case"left":return"up"}}getPlayer(t){let e=this.getCacheValue(t,"player");return e||(e=this.findPlayer(t),this.setCacheValue(t,"player",e)),e}findPlayer(t){return t.listObjs().find(e=>e.type==="player")}movePlayer(t,e,i){e.direction=i.direction,t.moveObj(e,i.position)}getCacheValue(t,e){let i=t.cacheId;return i===void 0&&(i=Math.random(),t.cacheId=i),this.cache[i]||(this.cache[i]={}),this.cache[i][e]}setCacheValue(t,e,i){let o=t.cacheId;o===void 0&&(o=Math.random(),t.cacheId=o),this.cache[o]||(this.cache[o]={}),this.cache[o][e]=i}},j=M;var u={};u["input_test2.txt"]=`
#...
....
....
^...
`;u["input_test.txt"]=`
....#.....
.........#
..........
..#.......
.......#..
..........
.#..^.....
........#.
#.........
......#...
`;u["input_puzzle.txt"]=`
......##...#...#....#.......#....................##............#.#..#.......#.........................................#...........
..................................#.............#................................#..........##..................#.................
....#......................#................#...........................................#....................................#....
............#..............#...#...#...............#..........#.#....#..........................#....##...........................
....#.............#.....#.....................................................................#...#..........................#....
.................#............#......................#.................#.............#..................#.........................
................#...............#....................#...#..#...#.#.....................................................#.........
..............#.#...............................................................#....................#.......#....................
.............#...#..#............................#..............#..#.........................................#....................
.........................#.........#..#.......#...#..............#..#..............................#.........#............#.......
#...............................................................................................................#.................
..........................#.....#.........................#...................#.......#.........................#.................
...........#...........#........#........................#..........#.#.................#........#............#...............#...
..#..#................#...................................................#..................................................#....
.....#............................#..........................................................................#....................
................#.....#...........................#..........................................#.........#........................#.
..#...........................................##............#.........#..........................#.......................#.....#..
.....................#.............#.....#.......#.##.....#......................................#.#..#.#.........................
.......#...##.....#..........#...............#....#..........................#..............................................##....
..#.......#..................##..............#..........................#.#....#....#....................#.#.#...............#....
....................#.......#.......#............#..............#.......#.........#...#.....#........#.#..........................
...............................................#.....#........................................#..#.........#..........#...........
............#...#.............................................................................#.......##..........................
##..........................#...........................#..............................#..........................................
..............................................#.............................................#.................................#...
.............#..............#................##...........#...............#.......................................................
......#............#.......#..#....#.............................................................................#.#..............
..#..##..#..................#...............................................##......#........................................#....
..#...............................#.#........#................................................#.....#........#.#..................
.........#.......#.....................................#............................#..............................#..............
..........................................................................................................#.....................#.
....................#......................................#..........................#.........................##................
........#..............................................................................#.#..................#..................#..
........................................................^..#...................#....#..............##.............................
..#.#........................................................#..#..................#.....................................#....#...
.........................#....#............................#......................................................................
.#......#.............................................................................................#....................###....
...........#...#.#............#........................................................................#..........................
......#..........#.............................#.#.................................#...#.............#.#........................#.
...............................................#..........#.......#.........#........................................#.#..........
.................#.....................#.......#..................................................................................
.#...............#.........#...................#..............#........................#.....#....................................
...........#..............#..................................................................#...................................#
.................#.............#...........#.......................................#......................#......#..........#.....
........#..#.................#..........#....................................................#.....#...........#.................#
.....................#..#.................#......#......#..#..#..........#........................#...........................##..
.................#........#....#.................................................#.#.........................#............#..#....
.....................#...............##...................#.....#..#............................#.#.............#.................
.#..#......##...............#.......#..........................................................................#......#...........
#..#...................................#.#................#.....#.................................#...........................#...
..............#............................#............#...#...#.............#..........#............#...#............#..........
..........##.................#................................#...........#.#....#...............................................#
......#...........#.............#..........#.............#............#...................#.......................#...............
..............#.......#...........................................................................................................
...#................................................................#...............................#....#...............#........
...#..##................#..............................................................................#..........##.#............
.#........#..........#..................#......................#...........#......................................................
....#.......................#...#...........................................#..................#...............................#..
.............................#...........#..........#.................#.....................................................#.....
...........#.........#............#...............................#................#..............#.........................#.....
..........#........#.....#.....................................#.................#.....................................#..#.......
...#.......#...................................................................#.................#................................
.#....#........#..............................#........#.....#........#..#...#.#......................#..........................#
.....................................................................#....................#.......................................
.............................#..............................#.#....................................................#............#.
..#.....#.......#.......#......................#.#.#.........................................................#.....#........#.....
...............#..........#..#....#..................#..........................................#.................................
............#...................#................#.............................................................................#..
........#...#......................................##....................#..................#..........##............#...#........
......................#......#......#.#.........................................................................#.............#...
........#......................................................................................#.................#................
.................................................#....................#..............##.......................................#..#
.............#..........................................................#.................#..........................#....#......#
......................#.....................#............................#..................#...........#.........................
#..............#...........................#...#.#................................................................................
.......#............................#...........................................................#...............#.................
........................#..................................................................................#......................
...................#..........................#.........#........#...........................#....................................
.............#............#.......................................................................................##....#.........
................#.........#.....................................................................................................#.
........#.............................#.................................#.......##..............#............................#....
#........#.....#.....#.......#...............................#....................................................#..............#
........................#.............................#.....#...........#........#............#...................................
..................#...........#...#.............................................................................#...............#.
...................#..................#...................#..............................#....#...........#..............#........
...............#................#.#....................#.........#.........#.............#.........#......#..................#....
..................#.............................#...........................#....#....#......#..#.#....................#..........
...#.......................................#...............................................................#................#.....
...................#.........................................................#....................................................
.................#..............................#.................................................................................
.............#.......#...#....................................................#........#....................................#...#.
..............#...................#.#..........#....................................................#....#...#.##....#............
........#..#...........................................#.........#...#...............#.........................#..................
#.....#...........................................#.................................................#.............................
#...........................................#..........#..........................................#...............#...............
............................#.................................................#...#...............................................
.#...................#.......................................................................................#......#...##..#.....
.....#..#...............#........#....#.........#........................#.............#..........................................
...................#................#........................................#.#..................................................
......#.#...........................#...................#..........#..........#......#............................................
..........................#.#..............#............#.#.......................................................................
...#..#........................#..............................................#..#...#.....#........#.............................
..........................#.....................#.........................................................#............#.#........
............................#.....................#.............#.................................................................
..........................................#..#.................................................................#......#.#.#.......
..........##......................................#................................##....................#..#.....................
..............#.......................................................#...........................................................
..........#........#........................................................................................#........#...#........
......................#.#...................#...............#.....#......................#.....#.......#.......#..........#.......
......#..#....#..................#.........................................#......................................................
...............#.....#..#..........................................##.........................................##.............#....
.....................#..................#..................................#...................#............................#.#...
..#................#..#................................................#...........#..........#.............#...................#.
.......#.............#.......................................................................#...#.........................##..#..
...#...................#..................#.............#..#.........................................#........##..................
.................................#...........#........#.....................#.........................#..#........................
.......#..................#..................................#......................................#.#....................#......
..................................................................................#...........#....#.......#......#..........#....
........##.........................................................#.......................#........#............#................
...#...............##.#..................#....................................#.............#.................#...................
..................##.........#...................#......#................#......................................................#.
.#....................#............#..............#.............#.........#........................................#......#..#....
...............#...........................................................#........................#.............#...............
#............................#...................#...............................##..#...............#..........................#.
................#.............#..........#.........#..........................#....#..............................#..............#
...................................#.........................................#....................................................
....#................................................................#.#..#..........#....#.............................#.........
...........#.............#..........#........#...#...#........#.............#.......................................##............
.........#.......................#..........#....#.......................................#.....#...#.#..........#.................
.......................#...........#.......#......#.#...............................................#.................#.#.........
`;var h=u;var b=class{constructor(t,e){this.objects=[];this.onAfterMoveListeners=[];this.width=t,this.height=e}getPlayer(){return this.listValidObjects().find(t=>t.type==="player")}getObjAt(t){return this.listValidObjects().find(e=>e.position.x===t.x&&e.position.y===t.y)||null}listObjs(){return this.listValidObjects()}isValidPosition(t){return t.x>=0&&t.x<this.width&&t.y>=0&&t.y<this.height}addObj(t,e){this.requireValidPosition(t.position),this.requireNoOccupiedPosition(t.position),t.map=this,t.position=e,this.objects.push(t)}moveObj(t,e){if(t.position.x===e.x&&t.position.y===e.y)return;this.requireValidPosition(e),this.requireNoOccupiedPosition(e);let i=t.position;t.position=e,this.onAfterMoveListeners.forEach(o=>o({obj:t,oldPosition:i,newPosition:e}))}onAfterMove(t){this.onAfterMoveListeners.push(t)}isPositionOccupied(t){return this.listValidObjects().some(e=>e.position.x===t.x&&e.position.y===t.y)}listValidObjects(){return this.objects.filter(t=>t.map===this)}requireNoOccupiedPosition(t){if(this.isPositionOccupied(t))throw new Error("Position already occupied")}requireValidPosition(t){if(!this.isValidPosition(t))throw new Error("Invalid position")}},w=b;function N(n){let t=h[n].trim().split("\r").join("").split(`
`),e=t[0].length,i=t.length,o=new w(e,i);return S(o,t),o}function S(n,t){for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++){let o=t[e][i];o==="#"?B(n,i,e):o==="^"&&H(n,i,e)}}function B(n,t,e){let i={type:"obstruction",position:{x:t,y:e},map:n};n.addObj(i,i.position)}function H(n,t,e){let i={type:"player",position:{x:t,y:e},map:n,direction:"up"};n.addObj(i,i.position)}var E=N;var y={},p={},V={},L={},D=!1,m=!1,l={},g=20,x=20,f=[],O=0,c={},d={},a={};function I(){A(),C(),p.onclick=()=>q()}function A(){y=document.getElementById("selectFile"),p=document.getElementById("playButton"),V=document.getElementById("speed"),l=document.getElementById("gameArea")}function C(){let n=Object.keys(h);y.innerHTML="",n.forEach(t=>{let e=document.createElement("option");e.value=t,e.text=t,y.appendChild(e)})}function q(){D?k():z()}function k(){m=!0,p.innerHTML="Stoping..."}function z(){O=0;let n=y.value,t=parseInt(V.value);a=E(n),c=new P({distinct:!0}),d=new P({distinct:!1}),_(a),a.onAfterMove(i=>{O++,i.obj.type==="player"&&(c.add(i.oldPosition),d.add(i.oldPosition)),T(),R(i)});let e=new j;L=setInterval(()=>{if(m||!e.hasNextMove(a)){let i=a.getPlayer();c.add(i.position),d.add(i.position),T(),console.log(n,"-> breadcrumbs: ",d.size()," or ",c.size(),"(distincts)"),clearInterval(L),F()}else e.nextMove(a)},t),W()}function F(){D=!1,m=!1,p.innerHTML="Play"}function W(){D=!0,m=!1,p.innerHTML="Stop"}function _(n){l.innerHTML="",f=[];for(let t=0;t<n.height;t++){let e=[];for(let i=0;i<n.width;i++){let o=document.createElement("div"),s=(i+t)%2===0?"even":"odd",r=n.getObjAt({x:i,y:t});o.style.width=g+"px",o.style.height=x+"px",o.classList.add("tile","empty",s),r&&(r.type!=="player"?o.classList.add("obstruction"):r.type==="player"&&o.classList.add("player")),o.style.display="inline-block",o.style.top=t*x+"px",o.style.left=i*g+"px",o.style.position="absolute",l.appendChild(o),e.push({el:o,status:"empty"})}f.push(e)}l.style.width=n.width*g+"px",l.style.height=n.height*x+"px"}function T(){document.querySelector("#time .value").innerHTML=O.toString(),document.querySelector("#breadcrumbs .value").innerHTML=c.size()+"/"+d.size()}function R(n){let{obj:t,oldPosition:e,newPosition:i}=n,o=f[e.y][e.x],s=f[i.y][i.x];o.el.classList.remove("player"),o.el.classList.add("breadcrumb"),s.el.classList.add("player")}setTimeout(I,100);
